# üöÄ Przewodnik Deployment na Produkcjƒô - Platforma Pakiety

**Data ostatniej aktualizacji:** 2025-10-28
**Testowa produkcja:** `admin.tg.stronazen.pl` - ‚úÖ SUKCES
**Rzeczywista produkcja:** (do uzupe≈Çnienia jutro)

---

## üìã CHECKLIST PRZED DEPLOYMENT

### 1. Przygotowanie lokalne
- [ ] `npm run build` - zbuduj frontend (sprawd≈∫ czy 0 b≈Çƒôd√≥w)
- [ ] Upewnij siƒô ≈ºe `public/build/.vite/manifest.json` istnieje (10-11KB)
- [ ] Sprawd≈∫ czy lokalnie wszystko dzia≈Ça w Docker
- [ ] **NIE kopiuj** `public/hot` - to plik development!

### 2. Backup serwera produkcyjnego
- [ ] Backup plik√≥w (ca≈Çy katalog `public_html/admin/`)
- [ ] Backup bazy MySQL (przez phpMyAdmin lub mysqldump)
- [ ] Zapisz backup `.env` (WA≈ªNE: bƒôdzie potrzebny p√≥≈∫niej!)

### 3. Dostƒôp do serwera
- [ ] WinSCP po≈ÇƒÖczenie dzia≈Ça (SSH key + has≈Ço)
- [ ] Zapamiƒôtaj: Host `s46.zenbox.pl`, Port `22`, User `mongaw`
- [ ] Terminal SSH otwarty i gotowy

---

## üéØ KROKI DEPLOYMENT (KROK PO KROKU)

### KROK 1: Upload plik√≥w przez WinSCP

**Katalog docelowy:**
```
/home/mongaw/domains/tg.stronazen.pl/public_html/admin/
```

**Co wgrywaƒá:**
- ‚úÖ `app/` - wszystkie pliki
- ‚úÖ `public/build/` - zbudowane assety (WA≈ªNE!)
- ‚úÖ `resources/` - wszystkie pliki
- ‚úÖ `routes/` - wszystkie pliki
- ‚úÖ `database/` - migracje i seedery
- ‚úÖ `composer.json`, `composer.lock`
- ‚úÖ `package.json`, `package-lock.json`

**Czego NIE wgrywaƒá:**
- ‚ùå `public/hot` - usu≈Ñ je≈õli istnieje!
- ‚ùå `node_modules/` - bƒôdzie zainstalowany w kontenerze
- ‚ùå `vendor/` - je≈õli ju≈º istnieje na serwerze
- ‚ùå `.env` - **ZACHOWAJ STARY PRODUKCYJNY** (zobacz KROK 2!)
- ‚ùå `storage/logs/` - zachowaj stare logi
- ‚ùå `database/database.sqlite` - produkcja u≈ºywa MySQL

---

### KROK 2: ‚ö†Ô∏è KRYTYCZNE - ZarzƒÖdzanie .env

**‚ùå NIE TW√ìRZ NOWEGO .env!**
**‚úÖ U≈ªYJ ISTNIEJƒÑCEGO PRODUKCYJNEGO .env**

#### Dlaczego?
Produkcyjny `.env` zawiera:
- Has≈Ça do bazy MySQL (nie znasz ich!)
- `APP_KEY` (zmiana = utrata sesji u≈ºytkownik√≥w)
- Konfiguracjƒô email/SMS
- Inne ustawienia produkcyjne

#### Co sprawdziƒá/zmieniƒá w produkcyjnym .env:

```bash
# Przez terminal SSH - sprawd≈∫ plik .env
cd /home/mongaw/domains/tg.stronazen.pl/public_html/admin
cat .env
```

**Wymagane ustawienia:**
```env
APP_ENV=production          # MUSI byƒá production!
APP_DEBUG=false             # MUSI byƒá false!
APP_URL=https://admin.tg.stronazen.pl

APP_TIMEZONE=Europe/Warsaw  # Dodaj je≈õli nie ma

DB_CONNECTION=mysql         # NIE sqlite!
DB_HOST=localhost
DB_DATABASE=mongaw_e2o91    # Nazwa bazy produkcyjnej
DB_USERNAME=mongaw_e2o91    # User produkcyjny
DB_PASSWORD=***             # Has≈Ço produkcyjne (NIE ZMIENIAJ!)
```

#### Jak edytowaƒá .env na serwerze:

**Opcja A: Przez WinSCP (≈Çatwiejsze)**
1. Znajd≈∫ `.env` w g≈Ç√≥wnym katalogu (prawy panel)
2. Prawy klik ‚Üí **Edit**
3. Zmie≈Ñ potrzebne warto≈õci
4. Zapisz (Ctrl+S)

**Opcja B: Przez terminal SSH**
```bash
nano /home/mongaw/domains/tg.stronazen.pl/public_html/admin/.env
# Edytuj, potem: Ctrl+O (save), Ctrl+X (exit)
```

---

### KROK 3: Fix manifest.json (KRYTYCZNE!)

**Problem:** Laravel szuka `public/build/manifest.json`, ale Vite tworzy `public/build/.vite/manifest.json`

**RozwiƒÖzanie:**
```bash
cd /home/mongaw/domains/tg.stronazen.pl/public_html/admin
cp public/build/.vite/manifest.json public/build/manifest.json
echo "‚úÖ manifest.json skopiowany!"
```

**Sprawd≈∫:**
```bash
ls -lh public/build/manifest.json
# Powinien pokazaƒá ~10-11KB, data dzisiejsza
```

---

### KROK 4: ‚ö†Ô∏è KRYTYCZNE - Usu≈Ñ public/hot

**Problem:** Je≈õli `public/hot` istnieje, Laravel my≈õli ≈ºe jest development mode i pr√≥buje ≈ÇƒÖczyƒá siƒô z `localhost:5173`!

**RozwiƒÖzanie:**
```bash
cd /home/mongaw/domains/tg.stronazen.pl/public_html/admin
rm -f public/hot
echo "‚úÖ public/hot usuniƒôty!"
```

**Sprawd≈∫ czy usuniƒôty:**
```bash
ls -la public/hot 2>&1 | grep "cannot access" && echo "‚úÖ OK" || echo "‚ùå B≈ÅƒÑD - plik nadal istnieje!"
```

---

### KROK 5: PHP 8.3 - Sprawd≈∫ wersjƒô

Laravel 11 wymaga PHP 8.2+

**Sprawd≈∫ wersjƒô CLI:**
```bash
php -v
# Je≈õli pokazuje 8.1.x - u≈ºyj pe≈Çnej ≈õcie≈ºki:
/opt/alt/php83/usr/bin/php -v
```

**Dla Zenbox:** Ustaw PHP 8.3 w panelu dla domeny (Zenbox ‚Üí Domeny ‚Üí admin.tg.stronazen.pl ‚Üí Ustawienia PHP)

**U≈ºywaj pe≈Çnej ≈õcie≈ºki w komendach:**
```bash
/opt/alt/php83/usr/bin/php artisan migrate
```

---

### KROK 6: Uruchom migracje bazy danych

```bash
cd /home/mongaw/domains/tg.stronazen.pl/public_html/admin

# Uruchom migracje
/opt/alt/php83/usr/bin/php artisan migrate --force

# Powiniene≈õ zobaczyƒá:
# ‚úì 2024_12_22_203832_create_alerts_table
# ‚úì 2024_12_22_211130_create_traffic_table
# ‚úì [16 migracji pakiet√≥w]
```

**Je≈õli b≈ÇƒÖd "already exists":**
```bash
# To OK - tabela ju≈º istnieje, pomi≈Ñ
```

---

### KROK 7: Wype≈Çnij us≈Çugi pakiet√≥w (SEEDER)

**WA≈ªNE:** Bez tego pakiety bƒôdƒÖ puste!

```bash
cd /home/mongaw/domains/tg.stronazen.pl/public_html/admin

# Uruchom seeder (23 us≈Çugi + mapowania)
/opt/alt/php83/usr/bin/php artisan db:seed --class=RealPackageServicesSeeder --force

# Powiniene≈õ zobaczyƒá:
# ‚úÖ Seeded 23 real package services
# ‚úÖ Seeded package_type_services for all 6 package types
```

**Sprawd≈∫ czy zadzia≈Ça≈Ço:**
```bash
mysql -u [USER] -p'[HAS≈ÅO]' [BAZA] -e "SELECT COUNT(*) as total FROM package_services;"
# Powinno pokazaƒá: total = 23

mysql -u [USER] -p'[HAS≈ÅO]' [BAZA] -e "SELECT COUNT(*) as total FROM package_type_services;"
# Powinno pokazaƒá: total = 35
```

---

### KROK 8: Wyczy≈õƒá cache Laravel

```bash
cd /home/mongaw/domains/tg.stronazen.pl/public_html/admin

# Wyczy≈õƒá WSZYSTKIE cache
/opt/alt/php83/usr/bin/php artisan config:clear
/opt/alt/php83/usr/bin/php artisan route:clear
/opt/alt/php83/usr/bin/php artisan view:clear
/opt/alt/php83/usr/bin/php artisan cache:clear

# Usu≈Ñ fizyczne pliki cache
rm -f bootstrap/cache/*.php
rm -rf storage/framework/views/*

echo "‚úÖ Cache wyczyszczony!"
```

---

### KROK 9: Ustaw polskƒÖ strefƒô czasowƒÖ

```bash
cd /home/mongaw/domains/tg.stronazen.pl/public_html/admin

# Dodaj/zmie≈Ñ APP_TIMEZONE w .env
sed -i 's/APP_TIMEZONE=.*/APP_TIMEZONE=Europe\/Warsaw/' .env || echo "APP_TIMEZONE=Europe/Warsaw" >> .env

# Wyczy≈õƒá cache
/opt/alt/php83/usr/bin/php artisan config:clear

echo "‚úÖ Strefa czasowa: Europe/Warsaw"
```

---

### KROK 10: Test aplikacji

1. **Otw√≥rz stronƒô w przeglƒÖdarce:**
   ```
   https://admin.tg.stronazen.pl
   ```

2. **Zaloguj siƒô** (u≈ºyj istniejƒÖcego konta)

3. **Test funkcjonalno≈õci:**
   - [ ] Dashboard siƒô ≈Çaduje
   - [ ] Zak≈Çadka "Pakiety" dzia≈Ça
   - [ ] "Dodaj nowy pakiet" ‚Üí wybierz typ 1, dodaj
   - [ ] Pakiet ma us≈Çugi (NIE jest pusty!)
   - [ ] Zaznacz us≈Çugƒô jako wykorzystanƒÖ
   - [ ] Historia pakietu pokazuje akcje (utworzenie, zaznaczenie)
   - [ ] "Pobierz PDF" generuje plik
   - [ ] Godziny w historii sƒÖ polskie (nie UTC)

4. **Sprawd≈∫ logi b≈Çƒôd√≥w:**
   ```bash
   tail -50 storage/logs/laravel.log
   # Nie powinno byƒá ERROR zwiƒÖzanych z packages
   ```

---

## üêõ TROUBLESHOOTING - RozwiƒÖzania problem√≥w

### Problem 1: Bia≈Çy ekran (ERR_CONNECTION_REFUSED localhost:5173)

**Przyczyna:** Plik `public/hot` istnieje
**Objawy:** Konsola przeglƒÖdarki pokazuje b≈Çƒôdy po≈ÇƒÖczenia z `localhost:5173`

**RozwiƒÖzanie:**
```bash
cd /home/mongaw/domains/tg.stronazen.pl/public_html/admin
rm -f public/hot
# Od≈õwie≈º przeglƒÖdarkƒô (Ctrl+Shift+R)
```

---

### Problem 2: B≈ÇƒÖd 500 - "Vite manifest not found"

**Przyczyna:** Brak `public/build/manifest.json`
**Objawy:** Strona pokazuje b≈ÇƒÖd 500, logi m√≥wiƒÖ "ViteManifestNotFoundException"

**RozwiƒÖzanie:**
```bash
cd /home/mongaw/domains/tg.stronazen.pl/public_html/admin
cp public/build/.vite/manifest.json public/build/manifest.json
ls -lh public/build/manifest.json  # Sprawd≈∫ czy ~10KB
```

---

### Problem 3: Pakiety bez us≈Çug (puste)

**Przyczyna:** Nie uruchomiono seedera
**Objawy:** Dodany pakiet nie ma ≈ºadnych us≈Çug w ≈õrodku

**RozwiƒÖzanie:**
```bash
cd /home/mongaw/domains/tg.stronazen.pl/public_html/admin

# Uruchom seeder
/opt/alt/php83/usr/bin/php artisan db:seed --class=RealPackageServicesSeeder --force

# Usu≈Ñ stary pusty pakiet
mysql -u [USER] -p'[HAS≈ÅO]' [BAZA] -e "DELETE FROM packages WHERE id = [ID_PUSTEGO_PAKIETU];"

# Dodaj nowy pakiet przez stronƒô - teraz bƒôdzie mia≈Ç us≈Çugi!
```

---

### Problem 4: Historia pakiet√≥w nie zapisuje akcji

**Przyczyna:** B≈ÇƒÖd SQL - sk≈Çadnia PostgreSQL w MySQL
**Objawy:** Logi pokazujƒÖ "Syntax error... details->>'service_name'"

**RozwiƒÖzanie:** ‚úÖ **JU≈ª NAPRAWIONE w kodzie!**

Kod u≈ºywa teraz uniwersalnej sk≈Çadni:
```php
->where('details->service_name', $value)  // Dzia≈Ça z MySQL i SQLite
```

**Je≈õli mimo to nie dzia≈Ça:**
```bash
# Sprawd≈∫ logi
grep "Failed to log" storage/logs/laravel.log | tail -10

# Je≈õli widzisz b≈Çƒôdy whereRaw - wymie≈Ñ plik kontrolera:
# Wgraj ≈õwie≈ºy PackageServiceUsageController.php z F:\Windsurf\PlatformaPakiety\
```

---

### Problem 5: Niepoprawna godzina w historii (UTC zamiast PL)

**Przyczyna:** Brak `APP_TIMEZONE=Europe/Warsaw` w `.env`
**Objawy:** Historia pokazuje czas 2 godziny w ty≈Ç

**RozwiƒÖzanie:**
```bash
cd /home/mongaw/domains/tg.stronazen.pl/public_html/admin

# Dodaj timezone do .env
echo "APP_TIMEZONE=Europe/Warsaw" >> .env

# Wyczy≈õƒá cache
/opt/alt/php83/usr/bin/php artisan config:clear
```

---

### Problem 6: B≈ÇƒÖd "Composer dependencies require PHP >= 8.2"

**Przyczyna:** Serwer u≈ºywa PHP 8.1 CLI
**Objawy:** Nie mo≈ºesz uruchomiƒá `php artisan ...`

**RozwiƒÖzanie:**
```bash
# Zawsze u≈ºywaj pe≈Çnej ≈õcie≈ºki do PHP 8.3:
/opt/alt/php83/usr/bin/php artisan migrate

# Lub ustaw alias w ~/.bashrc (opcjonalne):
alias php83='/opt/alt/php83/usr/bin/php'
# Potem: php83 artisan migrate
```

---

### Problem 7: B≈ÇƒÖd "Column 'enabled' cannot be null" (tabela alerts)

**Przyczyna:** Stare dane w tabeli `alerts` niezgodne z nowym schema
**Objawy:** Nie mo≈ºesz zapisaƒá alertu, b≈ÇƒÖd 500

**RozwiƒÖzanie:**
```bash
# Wyczy≈õƒá tabelƒô alerts
mysql -u [USER] -p'[HAS≈ÅO]' [BAZA] -e "TRUNCATE TABLE alerts;"
```

---

## üìÅ Pliki kt√≥re MUSISZ wymieniƒá/sprawdziƒá

### Kontrolery (zawierajƒÖ fix dla MySQL)
- ‚úÖ `app/Http/Controllers/PackageServiceUsageController.php` - fix whereRaw
- ‚úÖ `app/Http/Controllers/PackageController.php` - logging

### Assety frontend
- ‚úÖ `public/build/` - ca≈Çy katalog z buildu
- ‚úÖ `public/build/.vite/manifest.json` - musi istnieƒá
- ‚úÖ `public/build/manifest.json` - **SKOPIUJ z .vite/**

### Seeder
- ‚úÖ `database/seeders/RealPackageServicesSeeder.php` - 23 us≈Çugi + mapowania

### Migracje
- ‚úÖ Wszystkie pliki `database/migrations/2024_*_create_package*.php`

---

## üîí .env - Template dla produkcji

**‚ö†Ô∏è UWAGA: U≈ºywaj ISTNIEJƒÑCEGO produkcyjnego .env!**
To tylko szablon do sprawdzenia co powinno byƒá:

```env
# === PODSTAWOWE ===
APP_NAME='Panel :: Termy Gorce'
APP_ENV=production                    # MUSI BYƒÜ production!
APP_KEY=base64:***                    # NIE ZMIENIAJ istniejƒÖcego!
APP_DEBUG=false                       # MUSI BYƒÜ false!
APP_TIMEZONE=Europe/Warsaw            # Dodaj je≈õli nie ma
APP_URL=https://admin.tg.stronazen.pl

# === BAZA DANYCH (NIE ZMIENIAJ!) ===
DB_CONNECTION=mysql
DB_HOST=localhost
DB_PORT=3306
DB_DATABASE=mongaw_e2o91              # Nazwa z panelu
DB_USERNAME=mongaw_e2o91              # User z panelu
DB_PASSWORD=***                       # Has≈Ço z panelu - NIE ZMIENIAJ!

# === SESJE ===
SESSION_DRIVER=database
SESSION_LIFETIME=120
SESSION_ENCRYPT=true

# === POZOSTA≈ÅE (sprawd≈∫ czy sƒÖ) ===
BROADCAST_DRIVER=log
CACHE_DRIVER=file
QUEUE_CONNECTION=sync
```

---

## ‚úÖ CHECKLIST PO DEPLOYMENT

### Funkcjonalno≈õƒá
- [ ] Dashboard ≈Çaduje siƒô poprawnie
- [ ] Stare funkcje dzia≈ÇajƒÖ (Alerty, Traffic)
- [ ] Lista pakiet√≥w wy≈õwietla siƒô
- [ ] Mo≈ºna dodaƒá nowy pakiet
- [ ] Nowy pakiet ma us≈Çugi (nie jest pusty)
- [ ] Mo≈ºna zaznaczaƒá/odznaczaƒá us≈Çugi
- [ ] Historia pakietu zapisuje akcje
- [ ] PDF siƒô generuje i pobiera
- [ ] Godziny sƒÖ polskie (Europe/Warsaw)

### Bezpiecze≈Ñstwo
- [ ] `APP_ENV=production` w `.env`
- [ ] `APP_DEBUG=false` w `.env`
- [ ] `public/hot` NIE ISTNIEJE
- [ ] Logi nie pokazujƒÖ wra≈ºliwych danych

### Performance
- [ ] Cache wyczyszczony
- [ ] Strona ≈Çaduje siƒô szybko (<2s)
- [ ] Nie ma b≈Çƒôd√≥w w konsoli przeglƒÖdarki

---

## üìû Kontakt w razie problem√≥w

**Je≈õli co≈õ nie dzia≈Ça:**

1. **Sprawd≈∫ logi Laravel:**
   ```bash
   tail -100 storage/logs/laravel.log
   ```

2. **Sprawd≈∫ logi przeglƒÖdarki:**
   - F12 ‚Üí Console (szukaj b≈Çƒôd√≥w czerwonych)
   - F12 ‚Üí Network (szukaj 500/404)

3. **Sprawd≈∫ .env:**
   ```bash
   cat .env | grep -E "(APP_ENV|APP_DEBUG|DB_)"
   ```

4. **Wyczy≈õƒá cache ponownie:**
   ```bash
   /opt/alt/php83/usr/bin/php artisan config:clear
   /opt/alt/php83/usr/bin/php artisan cache:clear
   ```

---

## üéØ QUICK COMMANDS - Kopia-wklej

```bash
# DEPLOYMENT W 10 KOMENDACH (po wgraniu plik√≥w przez WinSCP)

cd /home/mongaw/domains/tg.stronazen.pl/public_html/admin

# 1. Usu≈Ñ public/hot
rm -f public/hot

# 2. Skopiuj manifest.json
cp public/build/.vite/manifest.json public/build/manifest.json

# 3. Sprawd≈∫ .env (APP_ENV=production, APP_DEBUG=false)
grep -E "(APP_ENV|APP_DEBUG)" .env

# 4. Dodaj timezone
echo "APP_TIMEZONE=Europe/Warsaw" >> .env

# 5. Migracje
/opt/alt/php83/usr/bin/php artisan migrate --force

# 6. Seeder us≈Çug
/opt/alt/php83/usr/bin/php artisan db:seed --class=RealPackageServicesSeeder --force

# 7-10. Wyczy≈õƒá cache
/opt/alt/php83/usr/bin/php artisan config:clear
/opt/alt/php83/usr/bin/php artisan route:clear
/opt/alt/php83/usr/bin/php artisan view:clear
/opt/alt/php83/usr/bin/php artisan cache:clear

echo "‚úÖ DEPLOYMENT ZAKO≈ÉCZONY - Testuj aplikacjƒô!"
```

---

## üìù Notatki z testowego deployment (2025-10-28)

**Co posz≈Ço nie tak (i jak naprawili≈õmy):**

1. ‚ùå `public/hot` skopiowany z development ‚Üí ‚úÖ usuniƒôty
2. ‚ùå `manifest.json` w z≈Çej lokalizacji ‚Üí ‚úÖ skopiowany do `public/build/`
3. ‚ùå PostgreSQL syntax w whereRaw ‚Üí ‚úÖ zmieniony na `->where('details->service_name')`
4. ‚ùå Brak us≈Çug w pakietach ‚Üí ‚úÖ uruchomiony RealPackageServicesSeeder
5. ‚ùå UTC timezone ‚Üí ‚úÖ ustawiony Europe/Warsaw

**Czas deployment:** ~45 minut (z troubleshootingiem)
**Rezultat:** 100% funkcjonalno≈õƒá dzia≈Ça! üéâ

---

## üíæ BACKUPY BAZY DANYCH - Automatyczna konfiguracja

**Status:** ‚úÖ Przetestowane na `admin.tg.stronazen.pl`
**Data:** 2025-10-29

### PrzeglƒÖd systemu backup√≥w

Po deployment musimy skonfigurowaƒá **automatyczne backupy MySQL**:
- **Czƒôstotliwo≈õƒá:** Codziennie o 3:00 w nocy
- **Typ:** MySQL dump + szyfrowanie GPG (AES-256)
- **Retencja:** 30 dni (stare automatycznie usuwane)
- **Lokalizacja:** `storage/backups/db_backup_YYYYMMDD_HHMMSS.sql.gpg`

---

### KROK 11: Konfiguracja automatycznych backup√≥w (PO DEPLOYMENT)

**‚ö†Ô∏è WA≈ªNE:** Wykonaj to **TYLKO RAZ** po pierwszym deployment!

#### 1. Dodaj BACKUP_PASSWORD do .env

**Otw√≥rz `.env` przez WinSCP** (Edit) i dodaj na ko≈Ñcu:

```env
BACKUP_PASSWORD=TwojeSilneHasloDoBackupow2025
```

**Przyk≈Çad dobrego has≈Ça:**
```env
BACKUP_PASSWORD=TermyGorce2025BackupSecure!PL
```

**‚ö†Ô∏è Zapisz to has≈Ço w bezpiecznym miejscu** (LastPass, 1Password) - bƒôdzie potrzebne do restore!

---

#### 2. Nadaj uprawnienia wykonywania skryptowi

```bash
cd /home/mongaw/domains/[TWOJA_DOMENA]/public_html/admin
chmod +x scripts/backup-database-universal.sh
chmod +x scripts/restore-database-universal.sh
```

---

#### 3. Test rƒôczny backup

```bash
cd /home/mongaw/domains/[TWOJA_DOMENA]/public_html/admin
bash scripts/backup-database-universal.sh
```

**Powinno pokazaƒá:**
```
‚úÖ Backup completed successfully!
Encrypted file: db_backup_20251029_XXXXXX.sql.gpg
```

**Sprawd≈∫ czy backup powsta≈Ç:**
```bash
ls -lh storage/backups/*.sql.gpg
```

---

#### 4. Skonfiguruj cron (automatyczne backupy)

**Komenda - Dodaj cron (raz):**
```bash
crontab -r  # Wyczy≈õƒá stare (je≈õli by≈Çy)
(echo "0 3 * * * cd /home/mongaw/domains/[TWOJA_DOMENA]/public_html/admin && bash scripts/backup-database-universal.sh >> storage/logs/backup.log 2>&1") | crontab -
```

**‚ö†Ô∏è ZAMIE≈É `[TWOJA_DOMENA]` na rzeczywistƒÖ domenƒô!**

Przyk≈Çad:
```bash
(echo "0 3 * * * cd /home/mongaw/domains/admin.produkcja.pl/public_html/admin && bash scripts/backup-database-universal.sh >> storage/logs/backup.log 2>&1") | crontab -
```

**Sprawd≈∫ czy cron zosta≈Ç dodany:**
```bash
crontab -l | grep backup
```

Powinno pokazaƒá **TYLKO 1 liniƒô** (nie duplikat):
```
0 3 * * * cd /home/mongaw/domains/.../admin && bash scripts/backup-database-universal.sh >> storage/logs/backup.log 2>&1
```

---

#### 5. Sprawd≈∫ logi backup√≥w (nastƒôpnego dnia)

```bash
tail -50 storage/logs/backup.log
```

Je≈õli backup dzia≈Ça≈Ç poprawnie, zobaczysz:
```
[2025-10-30 03:00:XX] Backup completed successfully!
```

---

### üîÑ Jak przywr√≥ciƒá backup (RESTORE)

**‚ö†Ô∏è UWAGA:** Restore **ZASTƒòPUJE CA≈ÅƒÑ BAZƒò DANYCH** - u≈ºywaj ostro≈ºnie!

#### Scenariusz 1: Interaktywny restore (wybierz z listy)

```bash
cd /home/mongaw/domains/[TWOJA_DOMENA]/public_html/admin
bash scripts/restore-database-universal.sh
```

Poka≈ºe listƒô backup√≥w:
```
Available backups:
1) db_backup_20251029_030000.sql.gpg
2) db_backup_20251028_030000.sql.gpg
3) db_backup_20251027_030000.sql.gpg

Enter number of backup to restore (or 'q' to quit):
```

Wpisz **numer** (np. `1`) i potwierd≈∫ `yes`.

---

#### Scenariusz 2: Restore konkretnego backupu

```bash
cd /home/mongaw/domains/[TWOJA_DOMENA]/public_html/admin
bash scripts/restore-database-universal.sh storage/backups/db_backup_20251029_030000.sql.gpg
```

Wpisz `yes` aby potwierdziƒá.

---

### üìã Checklist backup√≥w (po deployment)

- [ ] BACKUP_PASSWORD dodane do `.env`
- [ ] Skrypty backup/restore majƒÖ uprawnienia `chmod +x`
- [ ] Test rƒôczny backup dzia≈Ça (powstaje plik `.sql.gpg`)
- [ ] Cron skonfigurowany (`crontab -l` pokazuje backup)
- [ ] Test restore dzia≈Ça (na kopii bazy!)
- [ ] Has≈Ço BACKUP_PASSWORD zapisane w mened≈ºerze hase≈Ç

---

### üêõ Troubleshooting backup√≥w

#### Problem: "BACKUP_PASSWORD environment variable is not set"

**RozwiƒÖzanie:**
1. Sprawd≈∫ czy `BACKUP_PASSWORD` jest w `.env`:
   ```bash
   grep BACKUP_PASSWORD .env
   ```
2. Je≈õli brak - dodaj do `.env` i zapisz

---

#### Problem: "mysqldump: command not found"

**RozwiƒÖzanie:**
```bash
# Sprawd≈∫ czy mysqldump jest zainstalowany
which mysqldump

# Je≈õli nie - zainstaluj (skontaktuj siƒô z adminem serwera)
```

Na Zenbox hosting mysqldump powinien byƒá dostƒôpny domy≈õlnie.

---

#### Problem: Cron uruchamia backup 2 razy

**RozwiƒÖzanie:**
```bash
# Wyczy≈õƒá duplikaty
crontab -l | sort -u | crontab -

# Sprawd≈∫ czy jest tylko 1 wpis
crontab -l | grep backup
```

---

#### Problem: Backup siƒô tworzy, ale restore nie dzia≈Ça

**Przyczyna:** Z≈Çe has≈Ço lub uszkodzony plik

**RozwiƒÖzanie:**
```bash
# Test deszyfrowania (bez restore)
cd storage/backups
gpg --decrypt db_backup_20251029_XXXXXX.sql.gpg > /tmp/test.sql

# Je≈õli b≈ÇƒÖd "Bad session key" - z≈Çe has≈Ço!
# Je≈õli OK - plik jest poprawny
```

---

### üìÅ Co zawiera backup?

**Backup MySQL zawiera:**
- ‚úÖ Wszystkie tabele (packages, users, alerts, traffic, etc.)
- ‚úÖ Wszystkie dane (pakiety, us≈Çugi, logi, u≈ºytkownicy)
- ‚úÖ Strukturƒô bazy (CREATE TABLE statements)
- ‚úÖ Triggery i procedury (je≈õli sƒÖ)

**Backup NIE zawiera:**
- ‚ùå Plik√≥w (zdjƒôcia, PDF) - u≈ºywaj backup plik√≥w osobno
- ‚ùå Kodu aplikacji - kod jest w Git/FTP
- ‚ùå Konfiguracji `.env` - backup osobno!

---

### üí° Best Practices

1. **Test restore co miesiƒÖc** - upewnij siƒô ≈ºe backupy dzia≈ÇajƒÖ!
2. **Backup .env osobno** - rƒôcznie skopiuj przez WinSCP
3. **Eksportuj backupy do chmury** - Google Drive, Dropbox (co tydzie≈Ñ)
4. **Monitoruj logi** - sprawdzaj `storage/logs/backup.log`
5. **Zatrzymaj cron przed du≈ºymi zmianami** - `crontab -r` przed migracjƒÖ

---

### üîê Bezpiecze≈Ñstwo backup√≥w

**Backupy sƒÖ chronione:**
- üîí Szyfrowanie GPG AES-256 (militarny standard)
- üîí Has≈Ço wymagane do odczytu
- üîí Przechowywane lokalnie na serwerze (brak wysy≈Çania)

**Bez BACKUP_PASSWORD:**
- ‚ùå Nikt nie mo≈ºe otworzyƒá backupu
- ‚ùå Nawet z dostƒôpem do serwera backup jest bezu≈ºyteczny

**‚ö†Ô∏è Dlatego:**
- Zapisz BACKUP_PASSWORD w bezpiecznym miejscu!
- Je≈õli zgubisz has≈Ço - backupy sƒÖ nieodwracalnie zaszyfrowane!

---

**POWODZENIA W JUTRZEJSZYM RZECZYWISTYM DEPLOYMENT!** üöÄ

Je≈õli napotkasz problem kt√≥rego nie ma w tym dokumencie - sprawd≈∫ logi i dzia≈Çaj logicznie:
1. B≈ÇƒÖd 500? ‚Üí Sprawd≈∫ `storage/logs/laravel.log`
2. Bia≈Çy ekran? ‚Üí Sprawd≈∫ konsolƒô przeglƒÖdarki (F12)
3. Nie dzia≈Ça funkcja? ‚Üí Sprawd≈∫ czy plik kontrolera jest ≈õwie≈ºy
4. Problem z bazƒÖ? ‚Üí Sprawd≈∫ `.env` i po≈ÇƒÖczenie MySQL

**Nie panikuj - wszystkie problemy majƒÖ rozwiƒÖzanie!** üí™
