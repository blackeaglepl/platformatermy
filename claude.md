# Dokumentacja Projektu - Platforma Pakiety (TermyG√≥rce Admin)

## üìã Spis tre≈õci
1. [PrzeglƒÖd projektu](#przeglƒÖd-projektu)
2. [Stack technologiczny](#stack-technologiczny)
3. [Aktualna architektura](#aktualna-architektura)
4. [Obecne funkcjonalno≈õci](#obecne-funkcjonalno≈õci)
5. [API i komunikacja ze stronƒÖ Astro](#api-i-komunikacja-ze-stronƒÖ-astro)
6. [Nowe funkcjonalno≈õci - System zarzƒÖdzania pakietami](#nowe-funkcjonalno≈õci---system-zarzƒÖdzania-pakietami)

---

## üéØ PrzeglƒÖd projektu

**Nazwa:** Platforma Pakiety / TermyGorce Admin Panel
**Wersja:** 1.0
**Ostatnia aktualizacja:** Pa≈∫dziernik 2025

### Cel projektu
Panel administracyjny do zarzƒÖdzania komunikatami i informacjƒÖ o ruchu dla strony internetowej TermyG√≥rce (zbudowanej w Astro). Panel umo≈ºliwia pracownikom:
- ZarzƒÖdzanie alertami wy≈õwietlanymi na stronie g≈Ç√≥wnej
- Aktualizacjƒô informacji o natƒô≈ºeniu ruchu
- **[NOWE]** ZarzƒÖdzanie pakietami us≈Çug i ich wykorzystaniem

---

## üíª Stack technologiczny

### Backend
- **Framework:** Laravel 11.34
- **PHP:** 8.2+
- **Baza danych:** SQLite (development) / MySQL (production via Docker)
- **Autentykacja:** Laravel Breeze + Sanctum
- **API:** RESTful API (JSON)

### Frontend
- **Framework:** React 18.2
- **Jƒôzyk:** TypeScript 5.0
- **Build tool:** Vite 5.0
- **CSS Framework:** Tailwind CSS 3
- **UI Components:** Headless UI 2.0
- **Routing:** Inertia.js 1.0 (SPA-like experience bez API routingu)

### Narzƒôdzia deweloperskie
- **Docker:** Laravel Sail (kontenery dla PHP, MySQL, Redis)
- **Testing:** Pest PHP 3.6
- **Code quality:** Laravel Pint 1.13
- **Linting:** ESLint (TypeScript)

### Deployment
- **≈örodowisko:** Docker Desktop
- **Orchestracja:** docker-compose
- **Node.js:** v22.x (dla Vite i build procesu)

---

## üèóÔ∏è Aktualna architektura

### Struktura katalog√≥w
```
PlatformaPakiety/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ Enums/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AlertType.php          # WARNING, PROMO, INFO
‚îÇ   ‚îú‚îÄ‚îÄ Http/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Controllers/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ AlertController.php (pusty - do refaktoryzacji)
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ProfileController.php
‚îÇ   ‚îî‚îÄ‚îÄ Models/
‚îÇ       ‚îú‚îÄ‚îÄ Alert.php               # Model alert√≥w
‚îÇ       ‚îú‚îÄ‚îÄ Traffic.php             # Model natƒô≈ºenia ruchu
‚îÇ       ‚îî‚îÄ‚îÄ User.php                # Model u≈ºytkownik√≥w
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îÇ       ‚îú‚îÄ‚îÄ 2024_12_22_203832_create_alerts_table.php
‚îÇ       ‚îî‚îÄ‚îÄ 2024_12_22_211130_create_traffic_table.php
‚îú‚îÄ‚îÄ resources/
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ       ‚îú‚îÄ‚îÄ Pages/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.tsx       # G≈Ç√≥wny panel
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ Home/Partials/
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ UpdateAlertForm.tsx
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ UpdateTrafficForm.tsx
‚îÇ       ‚îî‚îÄ‚îÄ Layouts/
‚îÇ           ‚îî‚îÄ‚îÄ AuthenticatedLayout.tsx
‚îî‚îÄ‚îÄ routes/
    ‚îú‚îÄ‚îÄ web.php                     # Routing dla Inertia
    ‚îú‚îÄ‚îÄ api.php                     # **KLUCZOWE** - API dla strony Astro
    ‚îî‚îÄ‚îÄ auth.php                    # Routing autentykacji
```

---

## ‚úÖ Obecne funkcjonalno≈õci

### 1. System autentykacji
- Logowanie/Rejestracja u≈ºytkownik√≥w (Laravel Breeze)
- Weryfikacja email
- Reset has≈Ça
- ZarzƒÖdzanie profilem

### 2. Dashboard - ZarzƒÖdzanie alertami
**Lokalizacja:** `resources/js/Pages/Dashboard.tsx`

**Funkcjonalno≈õƒá:**
- Tworzenie/edycja alert√≥w wy≈õwietlanych na stronie Astro
- Pola alertu:
  - `enabled` (boolean) - czy alert jest aktywny
  - `text` (string) - tre≈õƒá komunikatu
  - `type` (enum) - typ: WARNING | PROMO | INFO
  - `order` (integer) - kolejno≈õƒá wy≈õwietlania

**Endpoint wewnƒôtrzny:**
- `PATCH /dashboard` - aktualizacja alertu

### 3. Dashboard - ZarzƒÖdzanie ruchem
**Lokalizacja:** `resources/js/Pages/Home/Partials/UpdateTrafficForm.tsx`

**Funkcjonalno≈õƒá:**
- Ustawienie aktualnego natƒô≈ºenia ruchu
- Warto≈õƒá liczbowa reprezentujƒÖca intensywno≈õƒá

**Endpoint wewnƒôtrzny:**
- `PATCH /dashboard` - aktualizacja warto≈õci ruchu

---

## üîó API i komunikacja ze stronƒÖ Astro

### ‚ö†Ô∏è KRYTYCZNE - NIE ZMIENIAƒÜ

**Strona Astro konsumuje publiczne API Laravel do wy≈õwietlania danych w czasie rzeczywistym.**

### Endpointy API (routes/api.php)

#### 1. GET /api/traffic
**Odpowiedzialny za:** Pobieranie aktualnego natƒô≈ºenia ruchu

**Request:**
```http
GET /api/traffic HTTP/1.1
Host: localhost
```

**Response:**
```json
75
```
(zwraca bezpo≈õrednio warto≈õƒá integer)

**Implementacja:**
```php
Route::get('/traffic', function (Request $request) {
    return Traffic::latest()->get()->value('value');
});
```

---

#### 2. GET /api/alerts
**Odpowiedzialny za:** Pobieranie aktywnych alert√≥w

**Request:**
```http
GET /api/alerts HTTP/1.1
Host: localhost
```

**Response (alert w≈ÇƒÖczony):**
```json
[
  {
    "type": "WARNING",
    "text": "Dzisiaj zwiƒôkszony ruch - prosimy o cierpliwo≈õƒá",
    "enabled": true
  }
]
```

**Response (alert wy≈ÇƒÖczony):**
```json
[]
```

**Implementacja:**
```php
Route::get('/alerts', function (Request $request) {
    $alert = Alert::first(); // zak≈Çadamy jeden globalny alert
    if ($alert && $alert->enabled == 1) {
        return [$alert]; // zwracamy jako array
    }
    return [];
});
```

### Struktura bazy danych

#### Tabela: `alerts`
```sql
CREATE TABLE alerts (
    id INTEGER PRIMARY KEY,
    enabled BOOLEAN DEFAULT 0,
    text VARCHAR(255) NOT NULL,
    type VARCHAR(50) NOT NULL,  -- WARNING | PROMO | INFO
    order INTEGER NOT NULL,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

#### Tabela: `traffic`
```sql
CREATE TABLE traffic (
    id INTEGER PRIMARY KEY,
    value INTEGER NOT NULL,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

### CORS i Security
- API jest publicznie dostƒôpne (bez autentykacji)
- CORS skonfigurowany w `config/cors.php`
- Strona Astro mo≈ºe pobieraƒá dane bez tokenu

---

## üÜï Nowe funkcjonalno≈õci - System zarzƒÖdzania pakietami

### Cel
Umo≈ºliwienie personelowi ≈õledzenia wykorzstania sprzedanych pakiet√≥w us≈Çug dla klient√≥w.

### User Flow

#### 1. Dodawanie nowego pakietu (Pracownik)
**Ekran:** Dashboard ‚Üí "Dodaj pakiet"

**Formularz:**
- **Typ pakietu:** Wyb√≥r z listy (1-6)
- **ID pakietu:** Rƒôczne wpisanie (np. "Kowalski_Styczen_2025")
- **Automatyczne przypisanie us≈Çug:** Na podstawie typu pakietu

**Typy pakiet√≥w (do uzgodnienia):**
```
Pakiet 1: [Lista us≈Çug]
Pakiet 2: [Lista us≈Çug]
Pakiet 3: [Lista us≈Çug]
Pakiet 4: [Lista us≈Çug]
Pakiet 5: [Lista us≈Çug]
Pakiet 6: [Lista us≈Çug]
```

#### 2. PrzeglƒÖdanie pakiet√≥w (Wszyscy pracownicy)
**Ekran:** Dashboard ‚Üí "Lista pakiet√≥w"

**Funkcjonalno≈õci:**
- Lista wszystkich pakiet√≥w
- Filtrowanie po:
  - ID pakietu
  - Typ pakietu
  - Status wykorzystania (%)
- Sortowanie po dacie dodania

#### 3. ZarzƒÖdzanie wykorzystaniem us≈Çug (Wszyscy pracownicy)
**Ekran:** Dashboard ‚Üí "Szczeg√≥≈Çy pakietu" ‚Üí [ID pakietu]

**Widok:**
```
Pakiet: Kowalski_Styczen_2025
Typ: Pakiet 3
Data utworzenia: 2025-01-15
Status: 60% wykorzystane

Us≈Çugi:
‚òë Masa≈º relaksacyjny (60 min) - u≈ºyto 2025-01-16 przez Jan Kowalski
‚òë Basen termalny (2h) - u≈ºyto 2025-01-17 przez Anna Nowak
‚òê Sauna fi≈Ñska (30 min) - niewykorzystane
‚òê Grota solna (45 min) - niewykorzystane
‚òë Jacuzzi (30 min) - u≈ºyto 2025-01-18 przez Jan Kowalski
```

**Akcje:**
- Klikniƒôcie checkboxa ‚Üí oznacza us≈Çugƒô jako wykorzystanƒÖ
- Automatyczne zapisanie:
  - Data wykorzystania
  - Kto zaznaczy≈Ç (user_id)
  - Timestamp

### Struktura bazy danych (propozycja)

#### Tabela: `packages`
```sql
CREATE TABLE packages (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    custom_id VARCHAR(255) UNIQUE NOT NULL,  -- np. "Kowalski_Styczen_2025"
    package_type INTEGER NOT NULL,           -- 1-6
    created_by INTEGER,                      -- user_id
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    FOREIGN KEY (created_by) REFERENCES users(id)
);
```

#### Tabela: `package_services`
```sql
CREATE TABLE package_services (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(255) NOT NULL,              -- nazwa us≈Çugi
    description TEXT,
    duration INTEGER,                        -- czas trwania w minutach
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

#### Tabela: `package_type_services` (relacja wiele-do-wielu)
```sql
CREATE TABLE package_type_services (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    package_type INTEGER NOT NULL,           -- 1-6
    service_id INTEGER NOT NULL,
    quantity INTEGER DEFAULT 1,              -- ile razy us≈Çuga w pakiecie
    FOREIGN KEY (service_id) REFERENCES package_services(id)
);
```

#### Tabela: `package_service_usage`
```sql
CREATE TABLE package_service_usage (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    package_id INTEGER NOT NULL,
    service_id INTEGER NOT NULL,
    used_at TIMESTAMP,
    marked_by INTEGER,                       -- user_id kt√≥ry zaznaczy≈Ç
    notes TEXT,                              -- opcjonalne notatki
    FOREIGN KEY (package_id) REFERENCES packages(id),
    FOREIGN KEY (service_id) REFERENCES package_services(id),
    FOREIGN KEY (marked_by) REFERENCES users(id)
);
```

### Endpointy API (propozycja)

#### ZarzƒÖdzanie pakietami
```
POST   /api/packages              - Utworzenie nowego pakietu
GET    /api/packages              - Lista wszystkich pakiet√≥w
GET    /api/packages/{id}         - Szczeg√≥≈Çy pakietu
PUT    /api/packages/{id}         - Aktualizacja pakietu
DELETE /api/packages/{id}         - Usuniƒôcie pakietu
```

#### ZarzƒÖdzanie wykorzystaniem us≈Çug
```
POST   /api/packages/{id}/services/{service_id}/mark-used
       - Oznacz us≈Çugƒô jako wykorzystanƒÖ

DELETE /api/packages/{id}/services/{service_id}/unmark
       - Cofnij wykorzystanie us≈Çugi

GET    /api/packages/{id}/usage-stats
       - Statystyki wykorzystania pakietu
```

#### Konfiguracja typ√≥w pakiet√≥w
```
GET    /api/package-types         - Lista typ√≥w pakiet√≥w z us≈Çugami
POST   /api/package-types/{type}/services
       - Dodaj us≈Çugƒô do typu pakietu (admin)
```

### Modele (propozycja)

```php
// app/Models/Package.php
class Package extends Model
{
    public function services()
    {
        return $this->belongsToMany(PackageService::class, 'package_service_usage')
            ->withPivot('used_at', 'marked_by', 'notes')
            ->withTimestamps();
    }

    public function creator()
    {
        return $this->belongsTo(User::class, 'created_by');
    }

    public function getUsagePercentageAttribute()
    {
        // Oblicz % wykorzystania
    }
}

// app/Models/PackageService.php
class PackageService extends Model
{
    // ...
}

// app/Models/PackageServiceUsage.php
class PackageServiceUsage extends Model
{
    // ...
}
```

### Komponenty React (propozycja)

```
resources/js/Pages/
‚îú‚îÄ‚îÄ Packages/
‚îÇ   ‚îú‚îÄ‚îÄ Index.tsx                 # Lista pakiet√≥w
‚îÇ   ‚îú‚îÄ‚îÄ Create.tsx                # Formularz dodawania
‚îÇ   ‚îú‚îÄ‚îÄ Show.tsx                  # Szczeg√≥≈Çy pakietu
‚îÇ   ‚îî‚îÄ‚îÄ Partials/
‚îÇ       ‚îú‚îÄ‚îÄ PackageList.tsx
‚îÇ       ‚îú‚îÄ‚îÄ ServiceCheckbox.tsx
‚îÇ       ‚îî‚îÄ‚îÄ UsageStats.tsx
```

---

## üìù Spos√≥b pracy z projektem

### Workflow z Claude Code
1. **Przed rozpoczƒôciem pracy:**
   - Przeczytaj [task.md](task.md) aby sprawdziƒá co zosta≈Ço ju≈º zrobione
   - Zaktualizuj statusy zada≈Ñ w [task.md](task.md)

2. **Podczas pracy:**
   - U≈ºywaj TodoWrite tool do zarzƒÖdzania bie≈ºƒÖcymi zadaniami
   - Po zako≈Ñczeniu ka≈ºdego zadania aktualizuj [task.md](task.md)
   - Zapisuj wa≈ºne decyzje i zmiany w [task.md](task.md)

3. **Po zako≈Ñczeniu sesji:**
   - Upewnij siƒô ≈ºe wszystkie zmiany sƒÖ zapisane w [task.md](task.md)
   - Zacommituj zmiany do Git z opisowymi wiadomo≈õciami

### Dokumentacja zada≈Ñ
Szczeg√≥≈Çowe zarzƒÖdzanie zadaniami i postƒôpami znajduje siƒô w **[task.md](task.md)**

---

## üìù Notatki deweloperskie

### ‚ö†Ô∏è Rzeczy do NIE ZMIENIAƒÜ (KRYTYCZNE)
- ‚ùå Endpointy `/api/traffic` i `/api/alerts`
- ‚ùå Struktura response JSON dla Astro
- ‚ùå Modele `Alert` i `Traffic`
- ‚ùå Tabele `alerts` i `traffic` w bazie danych
- ‚ùå IstniejƒÖce migracje w `database/migrations/`

### Pytania do rozwa≈ºenia
- Czy pakiety majƒÖ datƒô wa≈ºno≈õci?
- Czy mo≈ºna edytowaƒá ID pakietu po utworzeniu?
- Czy us≈Çugi mogƒÖ byƒá u≈ºywane wielokrotnie? (np. 3x masa≈º w pakiecie)
- Czy potrzebujemy historii zmian?
- Czy potrzebujemy eksportu do PDF/Excel?

---

## üîê Bezpiecze≈Ñstwo

### Autentykacja
- Wszystkie endpointy pakiet√≥w wymagajƒÖ autentykacji (`auth:sanctum`)
- Publiczne pozostajƒÖ tylko `/api/traffic` i `/api/alerts`

### Autoryzacja
- Ka≈ºdy zalogowany pracownik mo≈ºe:
  - Dodawaƒá pakiety
  - PrzeglƒÖdaƒá wszystkie pakiety
  - Zaznaczaƒá wykorzystanie us≈Çug
- Admin mo≈ºe:
  - Usuwaƒá pakiety
  - Modyfikowaƒá typy pakiet√≥w

---

## üìö Dodatkowe zasoby

- [Laravel 11 Documentation](https://laravel.com/docs/11.x)
- [React TypeScript Cheatsheet](https://react-typescript-cheatsheet.netlify.app/)
- [Inertia.js Documentation](https://inertiajs.com/)
- [Tailwind CSS Documentation](https://tailwindcss.com/docs)

---

**Ostatnia aktualizacja:** 2025-10-13
**Autor:** Zesp√≥≈Ç deweloperski TermyG√≥rce
