# Dokumentacja Projektu - Platforma Pakiety (TermyG√≥rce Admin)

## üìã Spis tre≈õci
1. [PrzeglƒÖd projektu](#przeglƒÖd-projektu)
2. [Stack technologiczny](#stack-technologiczny)
3. [‚ö†Ô∏è WA≈ªNE - Konfiguracja dla Windows + Docker](#-wa≈ºne---konfiguracja-dla-windows--docker)
4. [Aktualna architektura](#aktualna-architektura)
5. [Obecne funkcjonalno≈õci](#obecne-funkcjonalno≈õci)
6. [API i komunikacja ze stronƒÖ Astro](#api-i-komunikacja-ze-stronƒÖ-astro)
7. [Nowe funkcjonalno≈õci - System zarzƒÖdzania pakietami](#nowe-funkcjonalno≈õci---system-zarzƒÖdzania-pakietami)

---

## üéØ PrzeglƒÖd projektu

**Nazwa:** Platforma Pakiety / TermyGorce Admin Panel
**Wersja:** 1.0
**Ostatnia aktualizacja:** Pa≈∫dziernik 2025

### Cel projektu
Panel administracyjny do zarzƒÖdzania komunikatami i informacjƒÖ o ruchu dla strony internetowej TermyG√≥rce (zbudowanej w Astro). Panel umo≈ºliwia pracownikom:
- ZarzƒÖdzanie alertami wy≈õwietlanymi na stronie g≈Ç√≥wnej
- Aktualizacjƒô informacji o natƒô≈ºeniu ruchu
- **[NOWE]** ZarzƒÖdzanie pakietami us≈Çug i ich wykorzystaniem

---

## üíª Stack technologiczny

### Backend
- **Framework:** Laravel 11.34
- **PHP:** 8.2+
- **Baza danych:** SQLite (development) / MySQL (production via Docker)
- **Autentykacja:** Laravel Breeze + Sanctum
- **API:** RESTful API (JSON)

### Frontend
- **Framework:** React 18.2
- **Jƒôzyk:** TypeScript 5.0
- **Build tool:** Vite 5.0
- **CSS Framework:** Tailwind CSS 3
- **UI Components:** Headless UI 2.0
- **Routing:** Inertia.js 1.0 (SPA-like experience bez API routingu)

### Narzƒôdzia deweloperskie
- **Docker:** Laravel Sail (kontenery dla PHP, MySQL, Redis)
- **Testing:** Pest PHP 3.6
- **Code quality:** Laravel Pint 1.13
- **Linting:** ESLint (TypeScript)
- **MCP Integration:** Laravel MCP 0.1.1 (Model Context Protocol)

### Deployment
- **≈örodowisko:** Docker Desktop
- **Orchestracja:** docker-compose
- **Node.js:** v22.x (dla Vite i build procesu)

---

## ‚ö†Ô∏è WA≈ªNE - Konfiguracja dla Windows + Docker

### Problem Windows ‚Üî Linux Compatibility
Projekt jest rozwijany na **Windows**, ale uruchamiany w **Linux Docker containers**. To tworzy specyficzne wyzwania.

### RozwiƒÖzanie #1: Named Volume dla node_modules
**Problem:** Binarne pakiety npm (rollup, esbuild) sƒÖ kompilowane dla r√≥≈ºnych system√≥w operacyjnych.

**RozwiƒÖzanie:** W `docker-compose.yml` u≈ºywamy **named volume** dla `node_modules`:
```yaml
volumes:
    - '.:/var/www/html'
    - 'sail-node-modules:/var/www/html/node_modules'  # KRYTYCZNE!
```

**Efekt:**
- Kod ≈∫r√≥d≈Çowy jest synchronizowany z Windows
- `node_modules` ≈ºyje TYLKO w kontenerze Linux
- Brak konflikt√≥w binarnych

### RozwiƒÖzanie #2: Vite Configuration
**Problem:** Vite musi dzia≈Çaƒá w kontenerze, ale byƒá dostƒôpny z przeglƒÖdarki Windows.

**RozwiƒÖzanie:** W `vite.config.js`:
```javascript
server: {
    host: '0.0.0.0',           // Listen na wszystkich interfejsach (Docker)
    port: 5173,
    strictPort: true,
    hmr: {
        host: 'localhost',      // HMR dla przeglƒÖdarki Windows
    },
    watch: {
        usePolling: true,       // Lepsze wykrywanie zmian z Windows
    },
}
```

### RozwiƒÖzanie #3: Vite MUSI byƒá uruchomiony W kontenerze
‚ùå **NIE DZIA≈ÅA:**
```bash
npm run dev  # Uruchomione bezpo≈õrednio na Windows
```

‚úÖ **DZIA≈ÅA:**
```bash
docker exec platformapakiety-laravel.test-1 npm run dev  # W kontenerze
```

### RozwiƒÖzanie #4: U≈ºywaj `docker compose` zamiast `sail`
**Problem:** Laravel Sail nie dzia≈Ça w Git Bash (tylko w PowerShell/CMD/WSL2)

**RozwiƒÖzanie:** `start.bat` u≈ºywa bezpo≈õrednio `docker compose`:
```batch
docker compose up -d                                          # Zamiast: vendor\bin\sail up -d
docker exec platformapakiety-laravel.test-1 npm install      # Zamiast: sail npm install
docker exec platformapakiety-laravel.test-1 npm run dev      # Zamiast: sail npm run dev
```

### Quick Reference: Co gdzie?
| Element | Lokalizacja | System |
|---------|-------------|--------|
| Kod ≈∫r√≥d≈Çowy (.tsx, .php) | `F:\Windsurf\PlatformaPakiety\` | Windows (sync do kontenera) |
| node_modules | Docker volume `sail-node-modules` | Linux (TYLKO w kontenerze) |
| database.sqlite | `F:\Windsurf\PlatformaPakiety\database\` | Windows (sync do kontenera) |
| vendor/ (Composer) | `F:\Windsurf\PlatformaPakiety\vendor\` | Windows (sync do kontenera) |
| Vite dev server | Dzia≈Ça w kontenerze | Linux (port 5173 zmapowany) |
| Laravel | Dzia≈Ça w kontenerze | Linux (port 80 zmapowany) |

---

## üèóÔ∏è Aktualna architektura

### Struktura katalog√≥w
```
PlatformaPakiety/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ Enums/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AlertType.php          # WARNING, PROMO, INFO
‚îÇ   ‚îú‚îÄ‚îÄ Http/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Controllers/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ AlertController.php (pusty - do refaktoryzacji)
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ProfileController.php
‚îÇ   ‚îî‚îÄ‚îÄ Models/
‚îÇ       ‚îú‚îÄ‚îÄ Alert.php               # Model alert√≥w
‚îÇ       ‚îú‚îÄ‚îÄ Traffic.php             # Model natƒô≈ºenia ruchu
‚îÇ       ‚îî‚îÄ‚îÄ User.php                # Model u≈ºytkownik√≥w
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îÇ       ‚îú‚îÄ‚îÄ 2024_12_22_203832_create_alerts_table.php
‚îÇ       ‚îî‚îÄ‚îÄ 2024_12_22_211130_create_traffic_table.php
‚îú‚îÄ‚îÄ resources/
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ       ‚îú‚îÄ‚îÄ Pages/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.tsx       # G≈Ç√≥wny panel
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ Home/Partials/
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ UpdateAlertForm.tsx
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ UpdateTrafficForm.tsx
‚îÇ       ‚îî‚îÄ‚îÄ Layouts/
‚îÇ           ‚îî‚îÄ‚îÄ AuthenticatedLayout.tsx
‚îî‚îÄ‚îÄ routes/
    ‚îú‚îÄ‚îÄ web.php                     # Routing dla Inertia
    ‚îú‚îÄ‚îÄ api.php                     # **KLUCZOWE** - API dla strony Astro
    ‚îî‚îÄ‚îÄ auth.php                    # Routing autentykacji
```

---

## ‚úÖ Obecne funkcjonalno≈õci

### 1. System autentykacji
- Logowanie/Rejestracja u≈ºytkownik√≥w (Laravel Breeze)
- Weryfikacja email
- Reset has≈Ça
- ZarzƒÖdzanie profilem

### 2. Dashboard - ZarzƒÖdzanie alertami
**Lokalizacja:** `resources/js/Pages/Dashboard.tsx`

**Funkcjonalno≈õƒá:**
- Tworzenie/edycja alert√≥w wy≈õwietlanych na stronie Astro
- Pola alertu:
  - `enabled` (boolean) - czy alert jest aktywny
  - `text` (string) - tre≈õƒá komunikatu
  - `type` (enum) - typ: WARNING | PROMO | INFO
  - `order` (integer) - kolejno≈õƒá wy≈õwietlania

**Endpoint wewnƒôtrzny:**
- `PATCH /dashboard` - aktualizacja alertu

### 3. Dashboard - ZarzƒÖdzanie ruchem
**Lokalizacja:** `resources/js/Pages/Home/Partials/UpdateTrafficForm.tsx`

**Funkcjonalno≈õƒá:**
- Ustawienie aktualnego natƒô≈ºenia ruchu
- Warto≈õƒá liczbowa reprezentujƒÖca intensywno≈õƒá

**Endpoint wewnƒôtrzny:**
- `PATCH /dashboard` - aktualizacja warto≈õci ruchu

---

## üîó API i komunikacja ze stronƒÖ Astro

### ‚ö†Ô∏è KRYTYCZNE - NIE ZMIENIAƒÜ

**Strona Astro konsumuje publiczne API Laravel do wy≈õwietlania danych w czasie rzeczywistym.**

### Endpointy API (routes/api.php)

#### 1. GET /api/traffic
**Odpowiedzialny za:** Pobieranie aktualnego natƒô≈ºenia ruchu

**Request:**
```http
GET /api/traffic HTTP/1.1
Host: localhost
```

**Response:**
```json
75
```
(zwraca bezpo≈õrednio warto≈õƒá integer)

**Implementacja:**
```php
Route::get('/traffic', function (Request $request) {
    return Traffic::latest()->get()->value('value');
});
```

---

#### 2. GET /api/alerts
**Odpowiedzialny za:** Pobieranie aktywnych alert√≥w

**Request:**
```http
GET /api/alerts HTTP/1.1
Host: localhost
```

**Response (alert w≈ÇƒÖczony):**
```json
[
  {
    "type": "WARNING",
    "text": "Dzisiaj zwiƒôkszony ruch - prosimy o cierpliwo≈õƒá",
    "enabled": true
  }
]
```

**Response (alert wy≈ÇƒÖczony):**
```json
[]
```

**Implementacja:**
```php
Route::get('/alerts', function (Request $request) {
    $alert = Alert::first(); // zak≈Çadamy jeden globalny alert
    if ($alert && $alert->enabled == 1) {
        return [$alert]; // zwracamy jako array
    }
    return [];
});
```

### Struktura bazy danych

#### Tabela: `alerts`
```sql
CREATE TABLE alerts (
    id INTEGER PRIMARY KEY,
    enabled BOOLEAN DEFAULT 0,
    text VARCHAR(255) NOT NULL,
    type VARCHAR(50) NOT NULL,  -- WARNING | PROMO | INFO
    order INTEGER NOT NULL,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

#### Tabela: `traffic`
```sql
CREATE TABLE traffic (
    id INTEGER PRIMARY KEY,
    value INTEGER NOT NULL,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

### CORS i Security
- API jest publicznie dostƒôpne (bez autentykacji)
- CORS skonfigurowany w `config/cors.php`
- Strona Astro mo≈ºe pobieraƒá dane bez tokenu

---

## üÜï Nowe funkcjonalno≈õci - System zarzƒÖdzania pakietami

### Cel
Umo≈ºliwienie personelowi ≈õledzenia wykorzstania sprzedanych pakiet√≥w us≈Çug dla klient√≥w.

### User Flow

#### 1. Dodawanie nowego pakietu (Pracownik)
**Ekran:** Dashboard ‚Üí "Dodaj pakiet"

**Formularz:**
- **Typ pakietu:** Wyb√≥r z listy (1-6)
- **Automatyczne przypisanie us≈Çug:** Na podstawie typu pakietu


#### 2. PrzeglƒÖdanie pakiet√≥w (Wszyscy pracownicy)
**Ekran:** Dashboard ‚Üí "Lista pakiet√≥w"

**Funkcjonalno≈õci:**
- Lista wszystkich pakiet√≥w
- Filtrowanie po:
  - ID pakietu
  - Typ pakietu
  - Status wykorzystania (%)
- Sortowanie po dacie dodania

#### 3. ZarzƒÖdzanie wykorzystaniem us≈Çug (Wszyscy pracownicy)
**Ekran:** Dashboard ‚Üí "Szczeg√≥≈Çy pakietu" ‚Üí [ID pakietu]

**Widok:**
```
Pakiet: Kowalski_Styczen_2025
Typ: Pakiet 3
Data utworzenia: 2025-01-15
Status: 60% wykorzystane

Us≈Çugi:
‚òë Masa≈º relaksacyjny (60 min) - u≈ºyto 2025-01-16 przez Jan Kowalski
‚òë Basen termalny (2h) - u≈ºyto 2025-01-17 przez Anna Nowak
‚òê Sauna fi≈Ñska (30 min) - niewykorzystane
‚òê Grota solna (45 min) - niewykorzystane
‚òë Jacuzzi (30 min) - u≈ºyto 2025-01-18 przez Jan Kowalski
```

**Akcje:**
- Klikniƒôcie checkboxa ‚Üí oznacza us≈Çugƒô jako wykorzystanƒÖ
- Automatyczne zapisanie:
  - Data wykorzystania
  - Kto zaznaczy≈Ç (user_id)
  - Timestamp

### Struktura bazy danych (propozycja)

#### Tabela: `packages`
```sql
CREATE TABLE packages (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    package_id VARCHAR(255) UNIQUE NOT NULL,  -- automatycznie generowane (YYYYMMDD-XX)
    owner_name VARCHAR(255) NOT NULL,         -- imiƒô i nazwisko (np. "Jan Kowalski")
    package_type INTEGER NOT NULL,            -- 1-6
    created_by INTEGER,                       -- user_id
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    notes TEXT,                               -- opcjonalne uwagi
    FOREIGN KEY (created_by) REFERENCES users(id)
);
```

**‚ö†Ô∏è WA≈ªNA ZMIANA (2025-10-16):**
- `owner_name` **NIE MA** constraint UNIQUE - ta sama osoba mo≈ºe mieƒá wiele pakiet√≥w
- `package_id` jest unikalny i wystarcza do identyfikacji
- Brak brzydkich suffix√≥w (`_2`, `_3`) w PDF i UI

#### Tabela: `package_services`
```sql
CREATE TABLE package_services (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(255) NOT NULL,              -- nazwa us≈Çugi
    description TEXT,
    duration INTEGER,                        -- czas trwania w minutach
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

#### Tabela: `package_type_services` (relacja wiele-do-wielu)
```sql
CREATE TABLE package_type_services (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    package_type INTEGER NOT NULL,           -- 1-6
    service_id INTEGER NOT NULL,
    quantity INTEGER DEFAULT 1,              -- ile razy us≈Çuga w pakiecie
    FOREIGN KEY (service_id) REFERENCES package_services(id)
);
```

#### Tabela: `package_service_usage`
```sql
CREATE TABLE package_service_usage (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    package_id INTEGER NOT NULL,
    service_id INTEGER NOT NULL,
    used_at TIMESTAMP,
    marked_by INTEGER,                       -- user_id kt√≥ry zaznaczy≈Ç
    notes TEXT,                              -- opcjonalne notatki
    FOREIGN KEY (package_id) REFERENCES packages(id),
    FOREIGN KEY (service_id) REFERENCES package_services(id),
    FOREIGN KEY (marked_by) REFERENCES users(id)
);
```

### Endpointy API (propozycja)

#### ZarzƒÖdzanie pakietami
```
POST   /api/packages              - Utworzenie nowego pakietu
GET    /api/packages              - Lista wszystkich pakiet√≥w
GET    /api/packages/{id}         - Szczeg√≥≈Çy pakietu
PUT    /api/packages/{id}         - Aktualizacja pakietu
DELETE /api/packages/{id}         - Usuniƒôcie pakietu
```

#### ZarzƒÖdzanie wykorzystaniem us≈Çug
```
POST   /api/packages/{id}/services/{service_id}/mark-used
       - Oznacz us≈Çugƒô jako wykorzystanƒÖ

DELETE /api/packages/{id}/services/{service_id}/unmark
       - Cofnij wykorzystanie us≈Çugi

GET    /api/packages/{id}/usage-stats
       - Statystyki wykorzystania pakietu
```

#### Konfiguracja typ√≥w pakiet√≥w
```
GET    /api/package-types         - Lista typ√≥w pakiet√≥w z us≈Çugami
POST   /api/package-types/{type}/services
       - Dodaj us≈Çugƒô do typu pakietu (admin)
```

### Modele 

```php
// app/Models/Package.php
class Package extends Model
{
    public function services()
    {
        return $this->belongsToMany(PackageService::class, 'package_service_usage')
            ->withPivot('used_at', 'marked_by', 'notes')
            ->withTimestamps();
    }

    public function creator()
    {
        return $this->belongsTo(User::class, 'created_by');
    }

    public function getUsagePercentageAttribute()
    {
        // Oblicz % wykorzystania
    }
}

// app/Models/PackageService.php
class PackageService extends Model
{
    // ...
}

// app/Models/PackageServiceUsage.php
class PackageServiceUsage extends Model
{
    // ...
}
```

### Komponenty React 

```
resources/js/Pages/
‚îú‚îÄ‚îÄ Packages/
‚îÇ   ‚îú‚îÄ‚îÄ Index.tsx                 # Lista pakiet√≥w
‚îÇ   ‚îú‚îÄ‚îÄ Create.tsx                # Formularz dodawania
‚îÇ   ‚îú‚îÄ‚îÄ Show.tsx                  # Szczeg√≥≈Çy pakietu
‚îÇ   ‚îî‚îÄ‚îÄ Partials/
‚îÇ       ‚îú‚îÄ‚îÄ PackageList.tsx
‚îÇ       ‚îú‚îÄ‚îÄ ServiceCheckbox.tsx
‚îÇ       ‚îî‚îÄ‚îÄ UsageStats.tsx
```

---

## ü§ñ Laravel MCP Integration

### ‚ö†Ô∏è WYSOKI PRIORYTET - MCP Setup

**Status:** ‚úÖ Skonfigurowany i gotowy do u≈ºycia

**Laravel MCP** umo≈ºliwia bezpo≈õredniƒÖ interakcjƒô z aplikacjƒÖ Laravel przez Model Context Protocol, co znacznie przyspiesza development.

### Konfiguracja MCP

#### Zainstalowane komponenty:
- **Pakiet:** `laravel/mcp ^0.1.1`
- **Serwer MCP:** `PlatformaPakietyServer` w `app/Mcp/Servers/`
- **Narzƒôdzia:** `GetAlertsTool` (pobieranie alert√≥w z bazy)
- **Routing:** Zarejestrowany w `routes/ai.php` jako handle `pakiety`

#### Claude Code Integration:
```bash
# Automatycznie skonfigurowane w Claude Code
claude mcp add pakiety stdio -- docker exec platformapakiety-laravel.test-1 php artisan mcp:start pakiety
```

### Dostƒôpne narzƒôdzia MCP

#### 1. GetAlertsTool
- **Opis:** Pobiera wszystkie alerty z bazy danych
- **Parametry:** Brak (automatycznie pobiera wszystkie)
- **Response:** JSON z alertami (id, enabled, text, type, order, timestamps)
- **U≈ºycie:** Szybkie sprawdzenie stanu alert√≥w bez przeglƒÖdarki

### Korzy≈õci dla development

#### Natychmiastowe korzy≈õci:
- ‚úÖ **Szybkie testowanie modeli** - Alert, Traffic, Package bez UI
- ‚úÖ **API debugging** - testowanie `/api/traffic` i `/api/alerts`
- ‚úÖ **Baza danych** - bezpo≈õrednie zapytania do SQLite
- ‚úÖ **Eloquent testing** - weryfikacja relacji miƒôdzy modelami

#### Dla systemu pakiet√≥w:
- ‚úÖ **Package management** - testowanie logiki pakiet√≥w
- ‚úÖ **Service usage** - debugowanie wykorzystania us≈Çug
- ‚úÖ **Validation testing** - sprawdzanie walidacji formularzy

### Rozszerzenia MCP (planned)

#### Dodatkowe narzƒôdzia do utworzenia:
```php
// Przysz≈Çe narzƒôdzia MCP
GetPackagesTool::class,      // Lista pakiet√≥w z % wykorzystania
GetTrafficTool::class,       // Aktualny traffic
CreatePackageTool::class,    // Tworzenie pakietu przez MCP
ToggleServiceTool::class,    // Zaznaczanie us≈Çug jako wykorzystane
```

#### Resources (opcjonalne):
```php
// Zasoby dokumentacyjne przez MCP
PackageTypesResource::class, // Dokumentacja typ√≥w pakiet√≥w
APIDocsResource::class,      // Dokumentacja API endpoints
```

### ‚ö†Ô∏è WA≈ªNE - Restart Claude Code

Po ka≈ºdej zmianie w MCP konfiguracji:
1. Restart Claude Code aby za≈Çadowaƒá nowe MCP tools
2. MCP server dzia≈Ça automatycznie w kontenerze Docker
3. Brak potrzeby manualnego uruchamiania

---

## üìù Spos√≥b pracy z projektem

### Workflow z Claude Code
1. **Przed rozpoczƒôciem pracy:**
   - Przeczytaj [task.md](task.md) aby sprawdziƒá co zosta≈Ço ju≈º zrobione
   - Zaktualizuj statusy zada≈Ñ w [task.md](task.md)

2. **Podczas pracy:**
   - U≈ºywaj TodoWrite tool do zarzƒÖdzania bie≈ºƒÖcymi zadaniami
   - Po zako≈Ñczeniu ka≈ºdego zadania aktualizuj [task.md](task.md)
   - Zapisuj wa≈ºne decyzje i zmiany w [task.md](task.md)

3. **Po zako≈Ñczeniu sesji:**
   - Upewnij siƒô ≈ºe wszystkie zmiany sƒÖ zapisane w [task.md](task.md)
   - Zacommituj zmiany do Git z opisowymi wiadomo≈õciami

### Dokumentacja zada≈Ñ
Szczeg√≥≈Çowe zarzƒÖdzanie zadaniami i postƒôpami znajduje siƒô w **[task.md](task.md)**

---

## üìù Notatki deweloperskie

### ‚ö†Ô∏è Rzeczy do NIE ZMIENIAƒÜ (KRYTYCZNE)
- ‚ùå Endpointy `/api/traffic` i `/api/alerts`
- ‚ùå Struktura response JSON dla Astro
- ‚ùå Modele `Alert` i `Traffic`
- ‚ùå Tabele `alerts` i `traffic` w bazie danych
- ‚ùå IstniejƒÖce migracje w `database/migrations/`

### ‚ö†Ô∏è Wa≈ºne ustalenia dotyczƒÖce nazewnictwa p√≥l
**KRYTYCZNE:** W bazie danych pole zawierajƒÖce imiƒô i nazwisko posiadacza nazywa siƒô **`owner_name`**!

```
packages table:
- package_id (VARCHAR) - automatycznie generowane ID (YYYYMMDD-XX)
- owner_name (VARCHAR) - imiƒô i nazwisko posiadacza (np. "Jan Kowalski")
- package_type (INT)   - typ pakietu (1-6)
```

W kodzie backend zawsze u≈ºywaj `owner_name` do pracy z nazwiskiem klienta!

---

## üìÑ System generowania PDF pakiet√≥w

**Status:** ‚úÖ Zaimplementowany dla Pakietu 1 (Naturalna Harmonia)
**Data implementacji:** 2025-10-15

### PrzeglƒÖd funkcjonalno≈õci

System umo≈ºliwia automatyczne generowanie spersonalizowanych PDF dla pakiet√≥w us≈Çugowych. PDF zawiera:
- **Stronƒô 1:** Graficzny wz√≥r z dynamicznie wstawianymi danymi (ID, data, imiƒô i nazwisko)
- **Stronƒô 2:** StatycznƒÖ listƒô us≈Çug wchodzƒÖcych w sk≈Çad pakietu

### Stack technologiczny PDF

- **Biblioteka:** TCPDF 6.10 (`tecnickcom/tcpdf`)
- **Format:** DL poziomy (210mm x 99mm)
- **Czcionka:** DejaVu Sans (wbudowana w TCPDF, wspiera polskie znaki)
- **≈πr√≥d≈Ço t≈Ça:** Pliki JPG w `public/pdf-templates/`

### Struktura plik√≥w

```
public/pdf-templates/
‚îú‚îÄ‚îÄ pakiet-1-page1.jpg    # Strona 1 dla Pakietu 1 (Naturalna Harmonia)
‚îî‚îÄ‚îÄ pakiet-1-page2.jpg    # Strona 2 dla Pakietu 1 (lista us≈Çug)

app/Services/
‚îî‚îÄ‚îÄ PackagePdfService.php # Serwis generowania PDF

app/Http/Controllers/
‚îî‚îÄ‚îÄ PackageController.php # Endpoint generatePdf()

routes/
‚îî‚îÄ‚îÄ web.php              # Route: GET /packages/{id}/pdf
```

### Jak dzia≈Ça generowanie PDF

#### 1. Przycisk w UI (Show.tsx)
```tsx
<a
    href={route('packages.pdf', pkg.id)}
    target="_blank"
    className="..."
>
    üìÑ Pobierz PDF
</a>
```

#### 2. Endpoint w PackageController
```php
public function generatePdf(Package $package)
{
    $pdfService = new PackagePdfService();
    return $pdfService->downloadPdf($package);
}
```

#### 3. PackagePdfService - g≈Ç√≥wna logika

**Inicjalizacja:**
```php
$this->pdf = new TCPDF('L', 'mm', [99, 210], true, 'UTF-8', false);
$this->pdf->setPrintHeader(false);
$this->pdf->setPrintFooter(false);
$this->pdf->SetMargins(0, 0, 0);
$this->pdf->SetAutoPageBreak(false, 0);
```

**Strona 1 - nak≈Çadanie danych:**
```php
// Ustaw t≈Ço JPG
$backgroundPath = public_path('pdf-templates/pakiet-1-page1.jpg');
$this->pdf->Image($backgroundPath, 0, 0, 210, 99, 'JPG', '', '', false, 300);

// Dodaj ID pakietu (fioletowe pole)
$this->pdf->SetFont('dejavusans', '', 10);
$this->pdf->SetXY(25, 52);
$this->pdf->Cell(50, 5, $package->package_id, 0, 0, 'C', false);

// Dodaj datƒô (niebieskie pole)
$this->pdf->SetXY(25, 60);
$dateText = $package->created_at->format('d.m.Y');
$this->pdf->Cell(50, 5, $dateText, 0, 0, 'C', false);

// Dodaj imiƒô i nazwisko (r√≥≈ºowe pole)
$this->pdf->SetFont('dejavusans', 'B', 13);
$this->pdf->SetXY(100, 56);
$this->pdf->Cell(100, 6, mb_strtoupper($package->owner_name, 'UTF-8'), 0, 0, 'C', false);
```

**Strona 2 - statyczne t≈Ço:**
```php
$this->pdf->AddPage();
$backgroundPath = public_path('pdf-templates/pakiet-1-page2.jpg');
$this->pdf->Image($backgroundPath, 0, 0, 210, 99, 'JPG', '', '', false, 300);
```

### Pozycjonowanie tekstu na PDF

**Uk≈Çad wsp√≥≈Çrzƒôdnych TCPDF:**
- **X** - odleg≈Ço≈õƒá od lewej krawƒôdzi (mm)
- **Y** - odleg≈Ço≈õƒá od g√≥rnej krawƒôdzi (mm)
- **0,0** = lewy g√≥rny r√≥g

**Aktualne pozycje dla Pakietu 1:**

| Element | X (mm) | Y (mm) | Rozmiar | Wyr√≥wnanie | Lokalizacja na wzorze |
|---------|--------|--------|---------|------------|----------------------|
| ID pakietu | 25 | 52 | 10pt | Centered | Fioletowe pole |
| Data utworzenia | 25 | 60 | 10pt | Centered | Niebieskie pole |
| Imiƒô i nazwisko | 100 | 56 | 13pt Bold | Centered | R√≥≈ºowe pole |

**Jak dostosowaƒá pozycjonowanie:**

Edytuj `app/Services/PackagePdfService.php`, metoda `createPage1()`:

```php
// ID - zwiƒôksz X ≈ºeby przesunƒÖƒá w prawo, zwiƒôksz Y ≈ºeby przesunƒÖƒá w d√≥≈Ç
$this->pdf->SetXY(25, 52);  // X=25mm, Y=52mm

// DATA
$this->pdf->SetXY(25, 60);  // X=25mm, Y=60mm

// IMIƒò I NAZWISKO
$this->pdf->SetXY(100, 56); // X=100mm, Y=56mm
```

### Dodawanie kolejnych pakiet√≥w (2-6)

**Krok 1:** Dodaj wzory JPG do `public/pdf-templates/`:
```
pakiet-2-page1.jpg
pakiet-2-page2.jpg
pakiet-3-page1.jpg
pakiet-3-page2.jpg
... itd.
```

**Krok 2:** Rozszerz `PackagePdfService.php`:

```php
public function generatePackagePdf(Package $package): string
{
    // Dynamicznie wybierz template na podstawie package_type
    $this->createPage1($package);
    $this->createPage2($package);

    return $this->pdf->Output('', 'S');
}

protected function createPage1(Package $package): void
{
    $this->pdf->AddPage();

    // Wybierz t≈Ço na podstawie typu pakietu
    $templateNumber = $package->package_type;
    $backgroundPath = public_path("pdf-templates/pakiet-{$templateNumber}-page1.jpg");

    $this->pdf->Image($backgroundPath, 0, 0, 210, 99, 'JPG', '', '', false, 300);

    // WA≈ªNE: Pozycje mogƒÖ siƒô r√≥≈ºniƒá dla ka≈ºdego pakietu!
    // Dodaj switch/if dla r√≥≈ºnych typ√≥w:

    switch ($package->package_type) {
        case 1:
            $this->addTextForPackage1($package);
            break;
        case 2:
            $this->addTextForPackage2($package);
            break;
        // ... itd.
    }
}

private function addTextForPackage1(Package $package)
{
    // Pozycje dla Pakietu 1 (jak jest teraz)
    $this->pdf->SetXY(25, 52);
    $this->pdf->Cell(50, 5, $package->package_id, 0, 0, 'C');
    // ... itd.
}

private function addTextForPackage2(Package $package)
{
    // Pozycje dla Pakietu 2 (do ustalenia)
    $this->pdf->SetXY(30, 55);  // Inne pozycje!
    $this->pdf->Cell(50, 5, $package->package_id, 0, 0, 'C');
    // ... itd.
}
```

**Krok 3:** Dla ka≈ºdego nowego pakietu:
1. Otrzymaj wzory graficzne (JPG) dla strony 1 i 2
2. Stw√≥rz zdjƒôcie wzoru z zaznaczonymi polami (jak dla Pakietu 1)
3. Okre≈õl dok≈Çadne wsp√≥≈Çrzƒôdne XY dla ka≈ºdego pola
4. Dodaj metodƒô `addTextForPackageX()`
5. Przetestuj generowanie PDF

### Testowanie PDF lokalnie

**Metoda 1: Przez przeglƒÖdarkƒô**
```
1. Otw√≥rz http://localhost/packages
2. Wybierz pakiet
3. Kliknij "üìÑ Pobierz PDF"
```

**Metoda 2: Przez kod testowy**
```php
// test-pdf.php
$package = Package::first();
$pdfService = new PackagePdfService();
$pdfContent = $pdfService->generatePackagePdf($package);
file_put_contents('test.pdf', $pdfContent);
```

**Metoda 3: Przez Tinker**
```bash
docker exec platformapakiety-laravel.test-1 php artisan tinker

$package = App\Models\Package::first();
$service = new App\Services\PackagePdfService();
$pdf = $service->generatePackagePdf($package);
file_put_contents('test.pdf', $pdf);
```

### Mo≈ºliwe rozszerzenia

1. **Kod QR na PDF** - dodaj pakiet `bacon/bacon-qr-code`
2. **Watermark** - dodaj logo TermyG√≥rce jako watermark
3. **Dynamiczna lista us≈Çug** - renderuj us≈Çugi z bazy zamiast statycznego JPG
4. **Email z PDF** - wysy≈Çaj PDF automatycznie po utworzeniu pakietu
5. **Zapis w storage** - archiwizuj wygenerowane PDF w `storage/app/packages/`

### Troubleshooting

**Problem:** PDF siƒô nie generuje
```bash
# Sprawd≈∫ logi
docker exec platformapakiety-laravel.test-1 tail -50 /var/www/html/storage/logs/laravel.log

# Sprawd≈∫ czy pliki JPG istniejƒÖ
ls -la public/pdf-templates/
```

**Problem:** Polskie znaki siƒô nie wy≈õwietlajƒÖ
```php
// Upewnij siƒô ≈ºe u≈ºywasz mb_strtoupper z UTF-8
mb_strtoupper($text, 'UTF-8')

// I ≈ºe TCPDF ma ustawiony UTF-8
new TCPDF('L', 'mm', [99, 210], true, 'UTF-8', false);
```

**Problem:** Tekst jest w z≈Çym miejscu
```php
// Zmie≈Ñ wsp√≥≈Çrzƒôdne XY w createPage1()
$this->pdf->SetXY(X_MM, Y_MM);  // Zwiƒôksz X=prawo, Y=d√≥≈Ç
```

---

## üîê Bezpiecze≈Ñstwo

**Status:** ‚úÖ Zaimplementowane zabezpieczenia wielowarstwowe
**Data implementacji:** 2025-10-16

### PrzeglƒÖd zabezpiecze≈Ñ

System zosta≈Ç zabezpieczony na **5 poziomach**:
1. ‚úÖ **Rate Limiting** - ochrona przed automatycznym scrapowaniem
2. ‚úÖ **Audit Logging** - pe≈Çny audyt dostƒôpu do danych
3. ‚úÖ **HTTPS wymuszony** - szyfrowanie komunikacji w production
4. ‚úÖ **Session Encryption** - zaszyfrowane sesje u≈ºytkownik√≥w
5. ‚úÖ **Encrypted Backups** - automatyczne backupy z szyfrowaniem GPG

---

### 1. Rate Limiting (Throttling)

**Cel:** Zapobieganie automatycznemu pobieraniu danych przez boty/skrypty

**Implementacja:** [routes/web.php:40](routes/web.php)
```php
Route::middleware(['auth', 'verified', 'throttle:60,1'])->group(function () {
    // Wszystkie endpointy pakiet√≥w
});
```

**Limity:**
- **60 request√≥w na minutƒô** na u≈ºytkownika
- Po przekroczeniu: HTTP 429 (Too Many Requests)
- Licznik resetuje siƒô co minutƒô

**Co to chroni:**
- ‚ùå Masowe pobieranie danych klient√≥w
- ‚ùå Scraping bazy pakiet√≥w
- ‚ùå Brute-force na formularzach

---

### 2. Audit Logging z IP Address

**Cel:** ≈öledzenie kto, kiedy i skƒÖd dostƒôpowa≈Ç wra≈ºliwe dane

**Implementacja:** [app/Models/PackageLog.php](app/Models/PackageLog.php)

**Co jest logowane:**
```php
PackageLog {
    package_id: int,
    user_id: int,
    action_type: string,  // 'package_viewed', 'service_marked', etc.
    details: json,
    ip_address: string,   // üÜï IPv4/IPv6
    created_at: timestamp
}
```

**Przyk≈Çadowy log:**
```json
{
  "id": 123,
  "package_id": 45,
  "user_id": 2,
  "action_type": "package_viewed",
  "ip_address": "192.168.1.100",
  "created_at": "2025-10-16 14:30:22"
}
```

**Dostƒôp do log√≥w:**
- W interfejsie: Szczeg√≥≈Çy pakietu ‚Üí zak≈Çadka "Historia"
- Przez bazƒô: `SELECT * FROM package_logs WHERE package_id = X`
- Przez Tinker: `PackageLog::where('action_type', 'package_viewed')->get()`

**Automatycznie logowane akcje:**
| Akcja | Trigger | Lokalizacja kodu |
|-------|---------|------------------|
| `package_created` | Utworzenie pakietu | PackageController@store:158 |
| `package_viewed` | Wy≈õwietlenie szczeg√≥≈Ç√≥w | PackageController@show:185 |
| `service_marked` | Zaznaczenie us≈Çugi | PackageServiceUsageController@toggle |
| `service_unmarked` | Odznaczenie us≈Çugi | PackageServiceUsageController@toggle |
| `pdf_generated` | Pobranie PDF | PackageController@generatePdf:332 |
| `owner_updated` | Zmiana posiadacza | PackageController@updateOwner:264 |
| `notes_updated` | Edycja uwag | PackageController@updateNotes:294 |

---

### 3. HTTPS wymuszony (Production)

**Cel:** Szyfrowanie komunikacji miƒôdzy przeglƒÖdarkƒÖ a serwerem

**Implementacja:** [app/Providers/AppServiceProvider.php:27](app/Providers/AppServiceProvider.php)
```php
if ($this->app->environment('production')) {
    URL::forceScheme('https');
}
```

**Efekt:**
- Wszystkie URLe automatycznie `https://`
- Przekierowania u≈ºywajƒÖ HTTPS
- Cookies ustawione jako `secure`

**Konfiguracja dla production:**
```env
APP_ENV=production
APP_URL=https://yourdomain.com
```

---

### 4. Session Encryption

**Cel:** Ochrona danych sesji przed odczytem z bazy

**Konfiguracja:** [.env.example:33](.env.example)
```env
SESSION_DRIVER=database
SESSION_LIFETIME=120
SESSION_ENCRYPT=true  # üîê W≈ÇƒÖczone szyfrowanie
```

**Co jest szyfrowane:**
- Dane sesji w tabeli `sessions`
- Flash messages
- Dane formularzy (old input)
- CSRF tokens

**Algorytm:** AES-256-CBC (Laravel Encryption)

---

### 5. Automatyczne Backupy z Szyfrowaniem

**Cel:** Ochrona backup√≥w przed nieautoryzowanym dostƒôpem

#### ‚ö†Ô∏è WA≈ªNE: Uniwersalny system (SQLite + MySQL)

**Status:** ‚úÖ Wspiera oba ≈õrodowiska (development + production)

**Skrypty:**
- [scripts/backup-database-universal.sh](scripts/backup-database-universal.sh) - **ZALECANY** dla dev i production
- [scripts/backup-database.sh](scripts/backup-database.sh) - Legacy (tylko SQLite)

#### Jak dzia≈Ça uniwersalny backup

**Auto-detekcja typu bazy z `.env`:**
```bash
DB_CONNECTION=sqlite  ‚Üí Backup SQLite (cp + gpg)
DB_CONNECTION=mysql   ‚Üí Backup MySQL (mysqldump + gpg)
```

**Development (SQLite):**
1. Kopiuje `database/database.sqlite`
2. Szyfruje GPG ‚Üí `db_backup_YYYYMMDD_HHMMSS.sqlite.gpg`

**Production (MySQL):**
1. Eksportuje bazƒô ‚Üí `mysqldump platformapakiety > backup.sql`
2. Szyfruje GPG ‚Üí `db_backup_YYYYMMDD_HHMMSS.sql.gpg`

**Wsp√≥lne kroki:**
3. Usuwa niezaszyfrowanƒÖ kopiƒô
4. Czy≈õci backupy starsze ni≈º 30 dni

#### Rƒôczne uruchomienie

**Development:**
```bash
docker exec platformapakiety-laravel.test-1 bash /var/www/html/scripts/backup-database-universal.sh
```

**Production:**
```bash
ssh user@your-server
cd /var/www/html
bash scripts/backup-database-universal.sh
```

**Automatyzacja (cron):**

**Development (Docker):**
```bash
docker exec -it platformapakiety-laravel.test-1 bash
crontab -e
# Dodaj:
0 3 * * * BACKUP_PASSWORD="$BACKUP_PASSWORD" /var/www/html/scripts/backup-database-universal.sh >> /var/www/html/storage/logs/backup.log 2>&1
```

**Production (serwer):**
```bash
ssh user@your-server
crontab -e
# Dodaj:
0 3 * * * cd /var/www/html && BACKUP_PASSWORD="YourPassword" bash scripts/backup-database-universal.sh >> storage/logs/backup.log 2>&1
```

#### Restore z backupu

**Skrypty:**
- [scripts/restore-database-universal.sh](scripts/restore-database-universal.sh) - **ZALECANY** (SQLite + MySQL)
- [scripts/restore-database.sh](scripts/restore-database.sh) - Legacy (tylko SQLite)

**Development:**
```bash
# Interaktywny (wybierz z listy)
docker exec -it platformapakiety-laravel.test-1 bash /var/www/html/scripts/restore-database-universal.sh

# Konkretny backup
docker exec -it platformapakiety-laravel.test-1 bash /var/www/html/scripts/restore-database-universal.sh db_backup_20251016_030000.sqlite.gpg
```

**Production:**
```bash
ssh user@your-server
cd /var/www/html

# Interaktywny
bash scripts/restore-database-universal.sh

# Konkretny backup (MySQL)
bash scripts/restore-database-universal.sh db_backup_20251021_030000.sql.gpg
```

**‚ö†Ô∏è Wymagane potwierdzenie:** Musisz wpisaƒá `yes`

**‚ö†Ô∏è MySQL:** Restore **zastƒôpuje ca≈ÇƒÖ bazƒô** (wszystkie tabele DROP+CREATE)

#### Konfiguracja has≈Ça backupu

**W .env:**
```env
BACKUP_PASSWORD=YourSecureBackupPassword123!
```

**W docker-compose.yml:**
```yaml
environment:
  BACKUP_PASSWORD: '${BACKUP_PASSWORD:-ChangeThisPassword123!}'
```

**WA≈ªNE:**
- U≈ºyj **silnego has≈Ça** (min. 16 znak√≥w)
- **NIE commituj** `.env` do Git
- Zapisz has≈Ço w mened≈ºerze hase≈Ç (LastPass, 1Password)

#### Dokumentacja skrypt√≥w

**Pe≈Çne przewodniki:**
- [scripts/README.md](scripts/README.md) - Dokumentacja wszystkich skrypt√≥w
- [BACKUP_PRODUCTION.md](BACKUP_PRODUCTION.md) - **‚≠ê Przewodnik MySQL dla production**

**BACKUP_PRODUCTION.md zawiera:**
- ‚úÖ Por√≥wnanie SQLite vs MySQL
- ‚úÖ Szczeg√≥≈Çowa konfiguracja production
- ‚úÖ Instalacja wymaganych narzƒôdzi (mysqldump, gpg)
- ‚úÖ Troubleshooting dla MySQL
- ‚úÖ Eksport do chmury (S3, Google Drive)
- ‚úÖ Checklist przed wdro≈ºeniem

---

### Autentykacja

- **Wszystkie endpointy pakiet√≥w** wymagajƒÖ autentykacji (`auth` middleware)
- **Publiczne pozostajƒÖ tylko:** `/api/traffic` i `/api/alerts` (dla strony Astro)
- **Framework:** Laravel Breeze + Sanctum
- **Has≈Ça:** Bcrypt (12 rounds - domy≈õlnie z Laravel)

### Autoryzacja

**Ka≈ºdy zalogowany pracownik mo≈ºe:**
- ‚úÖ Dodawaƒá pakiety
- ‚úÖ PrzeglƒÖdaƒá wszystkie pakiety
- ‚úÖ Zaznaczaƒá wykorzystanie us≈Çug
- ‚úÖ Generowaƒá PDF
- ‚úÖ Edytowaƒá posiadaczy pakiet√≥w

**Admin mo≈ºe (do implementacji):**
- ‚ö†Ô∏è Usuwaƒá pakiety
- ‚ö†Ô∏è Modyfikowaƒá typy pakiet√≥w
- ‚ö†Ô∏è ZarzƒÖdzaƒá u≈ºytkownikami

---

### Opcjonalne rozszerzenia (do przysz≈Çej implementacji)

#### Opcja A: Szyfrowanie wra≈ºliwych danych (owner_name)

**Kiedy wdro≈ºyƒá:** Je≈õli wymagane przez RODO/audyt

**Implementacja:**
```php
// app/Models/Package.php
protected $casts = [
    'owner_name' => 'encrypted',  // Automatyczne AES-256 encryption
];
```

**Plusy:**
- ‚úÖ Kto≈õ kto ukradnie bazƒô zobaczy tylko gibberish
- ‚úÖ Zero zmian w kodzie aplikacji
- ‚úÖ U≈ºywa APP_KEY z .env

**Minusy:**
- ‚ùå Wyszukiwanie po zaszyfrowanych polach wymaga dodatkowego hash index
- ‚ùå Je≈õli kto≈õ ukradnie .env + bazƒô = ma wszystko

---

#### Opcja B: Database File Encryption (SQLCipher)

**Kiedy wdro≈ºyƒá:** Dla maksymalnego bezpiecze≈Ñstwa

**Implementacja:** Wymaga custom PDO drivera (skomplikowane)

**Plusy:**
- ‚úÖ Ca≈Ça baza zaszyfrowana na poziomie pliku (AES-256)
- ‚úÖ Nawet root nie odczyta bez has≈Ça

**Minusy:**
- ‚ùå Wymaga kompilacji PHP extension
- ‚ùå Trudniejsze w maintenance

**Status:** Od≈Ço≈ºone (backup encryption wystarcza)

---

#### Opcja C: Dual Database Approach

**Kiedy wdro≈ºyƒá:** Dla compliance z RODO

**Implementacja:**
```php
// Dane operacyjne w database.sqlite
'sqlite' => [ /* normalne dane */ ],

// Dane osobowe w oddzielnej bazie
'sqlite_sensitive' => [
    'database' => database_path('sensitive.sqlite'),
    'password' => env('DB_SENSITIVE_PASSWORD'),
],
```

**Plusy:**
- ‚úÖ Wyciek g≈Ç√≥wnej bazy ‚â† wyciek danych osobowych
- ‚úÖ ≈Åatwiejsze RODO compliance (oddzielne backupy/usuwanie)

**Minusy:**
- ‚ùå Wymaga refaktoryzacji modeli
- ‚ùå Joins miƒôdzy bazami sƒÖ trudniejsze

---

### Checklist zabezpiecze≈Ñ dla Production

#### Przed uruchomieniem:
- [ ] Ustaw `APP_ENV=production` w `.env`
- [ ] Wygeneruj nowy `APP_KEY`: `php artisan key:generate`
- [ ] Ustaw silne `BACKUP_PASSWORD` (min. 16 znak√≥w)
- [ ] W≈ÇƒÖcz `SESSION_ENCRYPT=true`
- [ ] Skonfiguruj HTTPS (certyfikat SSL)
- [ ] Ustaw `APP_DEBUG=false`
- [ ] Skonfiguruj cron dla automatycznych backup√≥w
- [ ] Przetestuj restore z backupu

#### Po uruchomieniu:
- [ ] Monitoruj logi: `storage/logs/laravel.log`
- [ ] Sprawdzaj logi backup√≥w: `storage/logs/backup.log`
- [ ] Regularnie przeglƒÖdaj `package_logs` (audyt dostƒôpu)
- [ ] Testuj restore z backupu raz na kwarta≈Ç
- [ ] Eksportuj backupy do chmury (S3/Google Drive)

#### Regularne przeglƒÖdy (co miesiƒÖc):
- [ ] Sprawd≈∫ czy backupy dzia≈ÇajƒÖ: `ls storage/backups/`
- [ ] Przejrzyj podejrzane logi IP: `SELECT * FROM package_logs WHERE ...`
- [ ] Zmie≈Ñ `BACKUP_PASSWORD` co 90 dni
- [ ] Usu≈Ñ stare backupy rƒôcznie je≈õli za du≈ºo miejsca

---

### Monitorowanie bezpiecze≈Ñstwa

#### Sprawd≈∫ ostatnie dostƒôpy do pakiet√≥w:
```sql
SELECT
    pl.created_at,
    u.name as user,
    pl.ip_address,
    p.owner_name as package_owner,
    pl.action_type
FROM package_logs pl
JOIN users u ON pl.user_id = u.id
JOIN packages p ON pl.package_id = p.id
WHERE pl.action_type = 'package_viewed'
ORDER BY pl.created_at DESC
LIMIT 50;
```

#### Sprawd≈∫ podejrzane IP (wiele request√≥w):
```sql
SELECT
    ip_address,
    COUNT(*) as request_count,
    MIN(created_at) as first_seen,
    MAX(created_at) as last_seen
FROM package_logs
GROUP BY ip_address
HAVING request_count > 100
ORDER BY request_count DESC;
```

#### Sprawd≈∫ backupy:
```bash
docker exec platformapakiety-laravel.test-1 bash -c "
  echo 'Total backups:' \$(ls -1 /var/www/html/storage/backups/*.gpg 2>/dev/null | wc -l)
  echo 'Total size:' \$(du -sh /var/www/html/storage/backups/ 2>/dev/null)
  echo 'Latest backup:' \$(ls -t /var/www/html/storage/backups/*.gpg 2>/dev/null | head -1)
"
```

---

### Kontakt w razie incydentu

**Podejrzany dostƒôp:**
1. Sprawd≈∫ logi: `package_logs` tabela
2. Zidentyfikuj IP: `SELECT * FROM package_logs WHERE ip_address = 'X.X.X.X'`
3. Zablokuj u≈ºytkownika je≈õli potrzeba
4. Zmie≈Ñ `APP_KEY` i `BACKUP_PASSWORD`

**Utrata danych:**
1. Natychmiast uruchom restore: `./scripts/restore-database.sh`
2. Sprawd≈∫ integralno≈õƒá: `sqlite3 database.sqlite "PRAGMA integrity_check;"`
3. Powiadom zesp√≥≈Ç

**Wyciek backupu:**
1. Dane sƒÖ zaszyfrowane GPG (AES-256)
2. Bez `BACKUP_PASSWORD` sƒÖ bezu≈ºyteczne
3. Zmie≈Ñ has≈Ço backupu natychmiast
4. Usu≈Ñ skompromitowane backupy

---

## üìö Dodatkowe zasoby

### Dokumentacja projektu
- **[DEPLOYMENT.md](DEPLOYMENT.md)** - Pe≈Çny przewodnik deployment (WinSCP, SSH, production setup)
- **[SECURITY.md](SECURITY.md)** - Polityka bezpiecze≈Ñstwa i raportowanie b≈Çƒôd√≥w
- **[scripts/README.md](scripts/README.md)** - Dokumentacja skrypt√≥w backup/restore

### Dokumentacja zewnƒôtrzna
- [Laravel 11 Documentation](https://laravel.com/docs/11.x)
- [React TypeScript Cheatsheet](https://react-typescript-cheatsheet.netlify.app/)
- [Inertia.js Documentation](https://inertiajs.com/)
- [Tailwind CSS Documentation](https://tailwindcss.com/docs)

---

**Ostatnia aktualizacja:** 2025-10-13
**Autor:** Zesp√≥≈Ç deweloperski TermyGorce Kamil + Micha≈Ç (je≈õli to czytasz to pozdrawiam)
